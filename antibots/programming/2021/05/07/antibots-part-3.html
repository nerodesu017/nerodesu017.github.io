<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>ANTIBOTS - PART III - Taking a look at the first part of the Incapsula antibot | NeroAdventures</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="ANTIBOTS - PART III - Taking a look at the first part of the Incapsula antibot" />
<meta name="author" content="Nero" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Foreword: Make sure you have NodeJS installed, a text editor or IDE (in my case I use VSCode) and most preferably Chrome as a browser (or any other Chromium based browser), but Firefox would suffice as well From now on, the whole project will be hosted at antibot-incapsula Tools used: ASTExplorer Google Incapsula is obfuscated using Obfuscator.io, while learning I haven’t used this and tried to do it all by myself which in my opinion was fun and made me use my brain more, though I strongly encourage its use in case you get stuck and need help or just want to see more obfuscations that it can do -&gt; Obfuscator.io on Github" />
<meta property="og:description" content="Foreword: Make sure you have NodeJS installed, a text editor or IDE (in my case I use VSCode) and most preferably Chrome as a browser (or any other Chromium based browser), but Firefox would suffice as well From now on, the whole project will be hosted at antibot-incapsula Tools used: ASTExplorer Google Incapsula is obfuscated using Obfuscator.io, while learning I haven’t used this and tried to do it all by myself which in my opinion was fun and made me use my brain more, though I strongly encourage its use in case you get stuck and need help or just want to see more obfuscations that it can do -&gt; Obfuscator.io on Github" />
<link rel="canonical" href="/antibots/programming/2021/05/07/antibots-part-3.html" />
<meta property="og:url" content="/antibots/programming/2021/05/07/antibots-part-3.html" />
<meta property="og:site_name" content="NeroAdventures" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-05-07T15:25:00+03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="ANTIBOTS - PART III - Taking a look at the first part of the Incapsula antibot" />
<script type="application/ld+json">
{"@type":"BlogPosting","url":"/antibots/programming/2021/05/07/antibots-part-3.html","headline":"ANTIBOTS - PART III - Taking a look at the first part of the Incapsula antibot","dateModified":"2021-05-07T15:25:00+03:00","datePublished":"2021-05-07T15:25:00+03:00","author":{"@type":"Person","name":"Nero"},"mainEntityOfPage":{"@type":"WebPage","@id":"/antibots/programming/2021/05/07/antibots-part-3.html"},"description":"Foreword: Make sure you have NodeJS installed, a text editor or IDE (in my case I use VSCode) and most preferably Chrome as a browser (or any other Chromium based browser), but Firefox would suffice as well From now on, the whole project will be hosted at antibot-incapsula Tools used: ASTExplorer Google Incapsula is obfuscated using Obfuscator.io, while learning I haven’t used this and tried to do it all by myself which in my opinion was fun and made me use my brain more, though I strongly encourage its use in case you get stuck and need help or just want to see more obfuscations that it can do -&gt; Obfuscator.io on Github","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="NeroAdventures" />
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">NeroAdventures</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">ANTIBOTS - PART III - Taking a look at the first part of the Incapsula antibot</h1>
    <p class="post-meta"><time class="dt-published" datetime="2021-05-07T15:25:00+03:00" itemprop="datePublished">
        May 7, 2021
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Nero</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <blockquote>
  <h2 id="foreword">Foreword:</h2>
  <ul>
    <li>
      <h3 id="make-sure-you-have-nodejs-installed-a-text-editor-or-ide-in-my-case-i-use-vscode-and-most-preferably-chrome-as-a-browser-or-any-other-chromium-based-browser-but-firefox-would-suffice-as-well">Make sure you have <a href="https://nodejs.org/en/">NodeJS</a> installed, a text editor or IDE (in my case I use <a href="https://code.visualstudio.com/">VSCode</a>) and most preferably <a href="https://www.google.com/chrome/">Chrome</a> as a browser (or any other Chromium based browser), but <a href="https://www.mozilla.org/en-US/firefox/new/">Firefox</a> would suffice as well</h3>
    </li>
    <li>
      <h3 id="from-now-on-the-whole-project-will-be-hosted-at-antibot-incapsula">From now on, the whole project will be hosted at <a href="https://github.com/nerodesu017/antibot-incapsula">antibot-incapsula</a></h3>
    </li>
    <li>
      <h3 id="tools-used">Tools used:</h3>
      <ul>
        <li>
          <h4 id="astexplorer"><a href="https://astexplorer.net/">ASTExplorer</a></h4>
        </li>
        <li>
          <h4 id="google"><a href="https://google.com">Google</a></h4>
        </li>
      </ul>
    </li>
    <li>
      <h3 id="incapsula-is-obfuscated-using-obfuscatorio-while-learning-i-havent-used-this-and-tried-to-do-it-all-by-myself-which-in-my-opinion-was-fun-and-made-me-use-my-brain-more-though-i-strongly-encourage-its-use-in-case-you-get-stuck-and-need-help-or-just-want-to-see-more-obfuscations-that-it-can-do---obfuscatorio-on-github">Incapsula is obfuscated using <a href="https://obfuscator.io/">Obfuscator.io</a>, while learning I haven’t used this and tried to do it all by myself which in my opinion was fun and made me use my brain more, though I strongly encourage its use in case you get stuck and need help or just want to see more obfuscations that it can do -&gt; <a href="https://github.com/javascript-obfuscator/javascript-obfuscator">Obfuscator.io on Github</a></h3>
    </li>
  </ul>
</blockquote>

<h4 id="ive-dug-a-little-bit-the-web-and-found-a-website-that-uses-incapsula-will-put-the-script-i-got-up-on-github-since-it-changes-values-every-time-and-they-have-checks-in-their-backend-the-script-i-provide-will-suffice-for-our-case">I’ve dug a little bit the web and found a website that uses Incapsula (will put the script I got up on github, since it changes values every time and they have checks in their backend, the script I provide will suffice for our case)</h4>
<h4 id="the-script-looks-something-like-this">The script looks something like this:</h4>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">z</span> <span class="o">=</span> <span class="dl">""</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">766172205[...LONG BORING STRING...]7d7d2829293b</span><span class="dl">"</span><span class="p">;</span>
  <span class="nb">eval</span><span class="p">((</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">z</span> <span class="o">+=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">16</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">z</span><span class="p">;</span>
  <span class="p">})());</span>
<span class="p">})();</span></code></pre></figure>

<h4 id="lets-plug-this-big-blob-in-astexplorer-and-see-what-kind-of-nodes-is-the-our-program-composed-of">Let’s plug this big blob in <a href="https://astexplorer.net/">ASTExplorer</a> and see what kind of nodes is the our Program composed of!</h4>

<p><img src="/assets/img/ANTIBOTS-PART-III-IMG-1.png" alt="img1" title="-" /></p>

<h4 id="plugging-the-script-in-astexplorer-tells-us-theres-a-single-node-so-if-youve-spent-a-bit-of-time-in-the-coding-world-youll-realize-that-this-node-is-an-iife-immediately-invoked-function-expression-it-is-a-function-that-has-no-name-just-like-a-lambda-and-gets-executed-the-moment-the-interpreter-gets-to-it">Plugging the script in <a href="https://astexplorer.net/">ASTExplorer</a> tells us there’s a single node! So, if you’ve spent a bit of time in the coding world you’ll realize that this node is an IIFE (Immediately Invoked Function Expression), it is a function that has no name (just like a lambda) and gets executed the moment the interpreter gets to it.</h4>

<h4 id="getting-back-to-the-script-and-looking-at-the-instructions-following-the-definition-of-the-boring-long-script-we-see-theres-an-eval-that-evaluates-the-string-that-gets-put-into-the-z-variable">Getting back to the script, and looking at the instructions following the definition of the boring long script, we see there’s an eval that evaluates the string that gets put into the ‘z’ variable</h4>

<h4 id="so-the-function-thats-passed-as-an-argument-to-the-eval-is-kind-of-like-a-decoding-function-transforms-the-b-string-into-actual-code-that-gets-put-into-the-z-variable-which-then-gets-executed-the-eval-function-only-executes-the-returnor-the-last-value-of-the-argument-it-gets-passed">So the function that’s passed as an argument to the eval is kind of like a decoding function, transforms the b string into actual code that gets put into the z variable, which then gets executed (the eval function only executes the return/or the last value of the argument it gets passed)</h4>

<h4 id="what-we-can-do-is-instead-of-returning-z-we-can-modify-that-line-to-log-the-script-to-the-console-so-it-ends-up-being-like-this">What we can do is, instead of returning z, we can modify that line to log the script to the console, so it ends up being like this:</h4>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">z</span> <span class="o">=</span> <span class="dl">""</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">766172205[...LONG BORING STRING...]7d7d2829293b</span><span class="dl">"</span><span class="p">;</span>
  <span class="nb">eval</span><span class="p">((</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">z</span> <span class="o">+=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">16</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">z</span><span class="p">);</span>
  <span class="p">})());</span>
<span class="p">})();</span></code></pre></figure>

<h4 id="since-there-are-no-checks-inside-the-first-script-you-can-just-execute-the-script-and-pipe-the-output-into-a-file-like-this">Since there are no checks inside the first script, you can just execute the script and pipe the output into a file like this:</h4>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">node incapsula.js <span class="o">&gt;</span> incapsula_unpacked.js</code></pre></figure>

  </div><a class="u-url" href="/antibots/programming/2021/05/07/antibots-part-3.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">Nero</li>
          <li><a class="u-email" href="mailto:nerodesu017@gmail.com">nerodesu017@gmail.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>The Adventures of a Rustacean named Nero</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/nerodesu017" title="nerodesu017"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/" title=""><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
